name: Automated CI/CD Pipeline

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install Python Dependencies
      run: |
        pip install pyinstaller

    - name: Build Application
      run: |
        pyinstaller --onefile app.py

    - name: Install Advanced Installer
      run: |
        choco install advanced-installer --version=22.3 -y

    - name: Configure and Build Installer
      shell: cmd
      run: |
        # Set up variables
        set APP_NAME=SimpleApp
        set OUTPUT_DIR=SimpleApp\Output
        set DIST_DIR=dist
        set AIP_FILE=SimpleAppInstaller.aip

        # Create new Advanced Installer project
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /new %AIP_FILE% /type exe

        # Set package name and output path
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /edit %AIP_FILE% /SetPackageName "%APP_NAME%.exe"
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /edit %AIP_FILE% /SetOutputPath "%OUTPUT_DIR%"

        # Add application files to installer
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /edit %AIP_FILE% /AddFolder "Application Folder" %DIST_DIR%

        # Add desktop shortcut
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /edit %AIP_FILE% /AddShortcut Desktop "Application Folder\%APP_NAME%.exe"

        # Set up other installer properties (e.g., version, icon, etc.)
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /edit %AIP_FILE% /SetVersion 1.0.0
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /edit %AIP_FILE% /SetIcon "dist\icon.ico"

        # Build the installer
        "C:\Program Files (x86)\Caphyon\Advanced Installer 22.3\bin\x86\AdvancedInstaller.com" /build %AIP_FILE%

    - name: Upload Installer to Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: SimpleAppInstaller
        path: SimpleApp\Output\*




